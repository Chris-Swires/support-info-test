<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Global Support Analysis | SNOMED International</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Solarized Theme */
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #eee8d5;
      color: #586e75;
    }

    .card {
      background-color: #fdf6e3;
      border-radius: 0.75rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .gradient-text {
      background: linear-gradient(45deg, #00A4E4, #326295);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .chart-container-lg {
      position: relative;
      height: 350px;
      width: 100%;
    }
  </style>
</head>

<body class="p-6 md:p-10">

  <header class="mb-10 text-center max-w-4xl mx-auto">
    <h1 class="text-4xl md:text-5xl font-black mb-4 heading-text">Global <span class="gradient-text">Support
        Analysis</span></h1>
    <p class="text-xl text-[#839496]">Insights into support volume, capacity limits, and system health.</p>
  </header>

  <!-- KPIs -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10 max-w-7xl mx-auto">
    <div class="card p-6 text-center border-t-4 border-[#2aa198]">
      <div class="text-3xl font-bold mb-2 text-[#586e75]" id="totalTickets">-</div>
      <div class="text-sm font-semibold uppercase tracking-wider text-[#93a1a1]">Total Tickets</div>
    </div>
    <div class="card p-6 text-center border-t-4 border-[#b58900]">
      <div class="text-3xl font-bold mb-2 text-[#586e75]" id="totalTime">-</div>
      <div class="text-sm font-semibold uppercase tracking-wider text-[#93a1a1]">Total Time Spent</div>
    </div>
    <div class="card p-6 text-center border-t-4 border-[#cb4b16]">
      <div class="text-3xl font-bold mb-2 text-[#586e75]" id="avgTimeTicket">-</div>
      <div class="text-sm font-semibold uppercase tracking-wider text-[#93a1a1]">Avg Time/Ticket</div>
    </div>
    <div class="card p-6 text-center border-t-4 border-[#268bd2]">
      <div class="text-3xl font-bold mb-2 text-[#586e75]" id="activeCountries">-</div>
      <div class="text-sm font-semibold uppercase tracking-wider text-[#93a1a1]">Active Countries</div>
    </div>
  </div>

  <!-- SUPPORT CHALLENGES -->
  <div class="max-w-7xl mx-auto mb-10">
    <h2 class="text-3xl font-black mb-6 text-[#586e75] border-b-2 border-[#dc322f] pb-2 inline-block">The "Drowning"
      Case: Support Challenges</h2>
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <div class="card p-6 border-l-8 border-[#dc322f]">
        <h3 class="text-lg font-bold mb-2 text-[#586e75] flex items-center"><i
            class="fas fa-balance-scale-right text-[#dc322f] mr-3"></i> Efficiency Ratio</h3>
        <p class="text-sm mb-4 text-[#93a1a1]">Ratio of Created vs Resolved. >1.0 means backlog is growing fast.</p>
        <div class="chart-container-lg" style="height: 250px;"><canvas id="efficiencyChart"></canvas></div>
      </div>
      <div class="card p-6 border-l-8 border-[#cb4b16]">
        <h3 class="text-lg font-bold mb-2 text-[#586e75] flex items-center"><i
            class="fas fa-exclamation-triangle text-[#cb4b16] mr-3"></i> Issue Criticality</h3>
        <p class="text-sm mb-4 text-[#93a1a1]">Profile of issue complexity based on Priority.</p>
        <div class="chart-container-lg" style="height: 250px;"><canvas id="criticalityChart"></canvas></div>
      </div>
      <div class="card p-6 border-l-8 border-[#6c71c4]">
        <h3 class="text-lg font-bold mb-2 text-[#586e75] flex items-center"><i
            class="fas fa-bed text-[#6c71c4] mr-3"></i> Ticket Stagnation</h3>
        <p class="text-sm mb-4 text-[#93a1a1]">"Zombie" tickets by inactivity period.</p>
        <div class="chart-container-lg" style="height: 250px;"><canvas id="stagnationChart"></canvas></div>
      </div>
    </div>
  </div>

  <!-- IMPROVEMENT OPPORTUNITIES (NEW) -->
  <div class="max-w-7xl mx-auto mb-10">
    <h2 class="text-3xl font-black mb-6 text-[#586e75] border-b-2 border-[#859900] pb-2 inline-block">Improvement
      Opportunities ("The Fix")</h2>
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- 1. Training Needs -->
      <div class="card p-6 border-l-8 border-[#2aa198]">
        <h3 class="text-lg font-bold mb-2 text-[#586e75] flex items-center"><i
            class="fas fa-chalkboard-teacher text-[#2aa198] mr-3"></i> Training Needs</h3>
        <p class="text-sm mb-4 text-[#93a1a1]">Top Reporters (Anonymized). Targeted training could reduce volume.</p>
        <div class="chart-container-lg" style="height: 250px;"><canvas id="trainingChart"></canvas></div>
      </div>

      <!-- 2. System Hotspots -->
      <div class="card p-6 border-l-8 border-[#b58900]">
        <h3 class="text-lg font-bold mb-2 text-[#586e75] flex items-center"><i
            class="fas fa-bug text-[#b58900] mr-3"></i> Bug Clusters</h3>
        <p class="text-sm mb-4 text-[#93a1a1]">Projects generating the most tickets. High ROI for refactoring.</p>
        <div class="chart-container-lg" style="height: 250px;"><canvas id="hotspotsChart"></canvas></div>
      </div>

      <!-- 3. Resolution Efficiency Profile -->
      <div class="card p-6 border-l-8 border-[#268bd2]">
        <h3 class="text-lg font-bold mb-2 text-[#586e75] flex items-center"><i
            class="fas fa-stopwatch text-[#268bd2] mr-3"></i> Resolution Profile</h3>
        <p class="text-sm mb-4 text-[#93a1a1]">Quick Wins (<1d) should be automated to free capacity.</p>
            <div class="chart-container-lg" style="height: 250px;"><canvas id="resolutionProfileChart"></canvas></div>
      </div>
    </div>
  </div>


  <!-- CAPACITY & PERFORMANCE DASHBOARD -->
  <div class="max-w-7xl mx-auto mb-10">
    <h2 class="text-3xl font-black mb-6 text-[#586e75] border-b-2 border-[#93a1a1] pb-2 inline-block">Capacity &
      Performance</h2>
    <div class="card p-6 mb-8 border-l-8 border-[#d33682]">
      <h3 class="text-xl font-bold mb-2 text-[#586e75] flex items-center"><i
          class="fas fa-users-cog text-[#d33682] mr-3"></i> Developer Workload Distribution (Anonymized)</h3>
      <p class="text-sm mb-4 text-[#93a1a1]">Total hours logged per developer.</p>
      <div class="chart-container-lg"><canvas id="devLoadChart"></canvas></div>
    </div>
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <div class="card p-6 border-l-8 border-[#cb4b16]">
        <h3 class="text-xl font-bold mb-2 text-[#586e75] flex items-center"><i
            class="fas fa-tachometer-alt text-[#cb4b16] mr-3"></i> Resolution Velocity</h3>
        <p class="text-sm mb-4 text-[#93a1a1]">Trend of average days to resolve a ticket.</p>
        <div class="chart-container-lg"><canvas id="velocityChart"></canvas></div>
      </div>
      <div class="card p-6 border-l-8 border-[#dc322f]">
        <h3 class="text-xl font-bold mb-2 text-[#586e75] flex items-center"><i
            class="fas fa-hourglass-half text-[#dc322f] mr-3"></i> Backlog Aging</h3>
        <p class="text-sm mb-4 text-[#93a1a1]">Average age of open tickets at month end.</p>
        <div class="chart-container-lg"><canvas id="agingChart"></canvas></div>
      </div>
    </div>
  </div>

  <!-- Standard Metrics -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-7xl mx-auto mb-8">
    <div class="card p-6">
      <h2 class="text-xl font-bold mb-6 text-[#586e75] flex items-center"><i
          class="fas fa-globe-americas text-[#268bd2] mr-3"></i> Support by Country</h2>
      <div class="chart-container-lg"><canvas id="countryChart"></canvas></div>
    </div>
    <div class="card p-6">
      <h2 class="text-xl font-bold mb-6 text-[#586e75] flex items-center"><i
          class="fas fa-fire text-[#6c71c4] mr-3"></i> Burndown Rate (Backlog)</h2>
      <div class="chart-container-lg"><canvas id="burndownChart"></canvas></div>
    </div>
  </div>

  <!-- Top 10 Issues -->
  <div class="max-w-4xl mx-auto mb-16">
    <div class="card p-8 border-l-8 border-[#268bd2]">
      <h2 class="text-2xl font-black mb-6 text-[#586e75] flex items-center"><i
          class="fas fa-check-double text-[#268bd2] mr-3"></i> Top 10 Common Support Issues</h2>
      <div id="issuesList" class="space-y-4">Loading...</div>
    </div>
  </div>

  <script src="data.js"></script>
  <script>
    const topIssues = [
      { phrase: "Task Promotion / Workflow", count: 60, time: 318900, example: "Unable to promote CMTDRO-424 to the next stage due to validation errors." },
      { phrase: "Assertion Failure / Validation", count: 48, time: 229620, example: "AP: Project 'AT Extension (AT)' - failed assertion during release validation." },
      { phrase: "Snapshot/Delta File Errors", count: 40, time: 179580, example: "New inactive states follow active states in the Owl Expression snapshot file." },
      { phrase: "Previous Release Compatibility", count: 31, time: 166680, example: "AU: 4x unexpected refset descriptor records compared to previous release." },
      { phrase: "Main / Branching Issues", count: 22, time: 193860, example: "Confirm no issues with bug in MAINT-2687 when completing 2024 refsets." },
      { phrase: "International Edition Support", count: 22, time: 84600, example: "Investigate unexpected TextDefinition record in EE May 2025 release." },
      { phrase: "United States Project", count: 20, time: 12300, example: "United States: Change US Extension authoring project lead/owner." },
      { phrase: "Release Issues", count: 17, time: 93900, example: "Drools [update]: Remove hardcoded char limit from description validation." },
      { phrase: "Java / Code Errors", count: 19, time: 28800, example: "RVF assertion not working as expected - [Java] NullPointerException." },
      { phrase: "Module / Jumper Issues", count: 15, time: 55000, example: "Belgium: BE: Module jumpers (affected INT OWL axioms)." }
    ];

    window.addEventListener('load', () => {
      if (typeof jiraData === 'undefined') { console.error("No Data"); return; }

      const months = { 'Jan': 0, 'Feb': 1, 'Mar': 2, 'Apr': 3, 'May': 4, 'Jun': 5, 'Jul': 6, 'Aug': 7, 'Sep': 8, 'Oct': 9, 'Nov': 10, 'Dec': 11 };
      function parseDate(dateStr) {
        if (!dateStr) return null;
        const parts = dateStr.split(' ');
        const dateParts = parts[0].split('/');
        if (dateParts.length < 3) return null;
        const year = parseInt(dateParts[2], 10) + 2000;
        return new Date(year, months[dateParts[1]], parseInt(dateParts[0], 10));
      }

      const excludeTags = new Set(["Dev-Support", "Managed-Service", "Devops-Dependency", "Bug", "Improvement", "Service Request"]);
      function getCountry(item) {
        if (item.country) return item.country;
        if (item.labels && item.labels.length > 0) {
          const pot = item.labels.find(l => !excludeTags.has(l));
          if (pot) return pot;
        }
        return "Global/Unspecified";
      }

      const processed = jiraData.map(item => ({
        ...item,
        createdDate: parseDate(item.created),
        resolvedDate: parseDate(item.resolved),
        updatedDate: parseDate(item.updated),
        countryResolved: getCountry(item),
        time: parseInt(item.timeSpent || '0', 10),
        assigneeName: item.assignee || 'Unassigned',
        priority: item.priority || 'Medium',
        reporter: item.reporter || 'Unknown',
        project: item.projectName || 'Unknown'
      })).sort((a, b) => (a.createdDate || 0) - (b.createdDate || 0));

      const totalTickets = processed.length;
      const totalTime = processed.reduce((acc, c) => acc + c.time, 0);
      const countries = new Set(processed.map(p => p.countryResolved).filter(c => c !== 'Global/Unspecified')).size;

      document.getElementById('totalTickets').textContent = totalTickets;
      document.getElementById('totalTime').textContent = Math.round(totalTime / 3600) + 'h';
      document.getElementById('avgTimeTicket').textContent = (totalTickets ? Math.round((totalTime / totalTickets / 3600) * 10) / 10 : 0) + 'h';
      document.getElementById('activeCountries').textContent = countries;

      // --- IMPROVEMENT METRICS (NEW) ---

      // 1. Training Needs (Top Reporters)
      const reporterCounts = {};
      processed.forEach(d => { reporterCounts[d.reporter] = (reporterCounts[d.reporter] || 0) + 1; });
      const topReporters = Object.entries(reporterCounts)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5)
        .map((r, i) => ({ name: `User ${i + 1}`, count: r[1] })); // Anonymize

      new Chart(document.getElementById('trainingChart'), {
        type: 'bar',
        data: {
          labels: topReporters.map(r => r.name),
          datasets: [{ label: 'Tickets Created', data: topReporters.map(r => r.count), backgroundColor: '#2aa198', borderRadius: 4 }]
        },
        options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } }, plugins: { legend: { display: false } } }
      });

      // 2. System Hotspots (By Project)
      const projCounts = {};
      processed.forEach(d => { projCounts[d.project] = (projCounts[d.project] || 0) + 1; });
      const topProjs = Object.entries(projCounts).sort((a, b) => b[1] - a[1]).slice(0, 5);

      new Chart(document.getElementById('hotspotsChart'), {
        type: 'doughnut',
        data: {
          labels: topProjs.map(p => p[0]),
          datasets: [{ data: topProjs.map(p => p[1]), backgroundColor: ['#b58900', '#cb4b16', '#dc322f', '#d33682', '#6c71c4'], borderWidth: 0 }]
        },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' } } }
      });

      // 3. Resolution Efficiency Profile
      const resBuckets = { quick: 0, standard: 0, slog: 0 };
      processed.forEach(d => {
        if (d.resolvedDate && d.createdDate) {
          const diffDays = (d.resolvedDate - d.createdDate) / (1000 * 60 * 60 * 24);
          if (diffDays <= 1) resBuckets.quick++;
          else if (diffDays <= 7) resBuckets.standard++;
          else resBuckets.slog++;
        }
      });
      new Chart(document.getElementById('resolutionProfileChart'), {
        type: 'bar',
        data: {
          labels: ['Quick Wins (<1d)', 'Standard (1-7d)', 'Slog (>7d)'],
          datasets: [{ label: 'Tickets', data: [resBuckets.quick, resBuckets.standard, resBuckets.slog], backgroundColor: ['#2aa198', '#268bd2', '#dc322f'], borderRadius: 4 }]
        },
        options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } }, plugins: { legend: { display: false } } }
      });

      // --- CHALLENGES METRICS ---
      const monthlyCreated = {}; const monthlyResolved = {};
      processed.forEach(d => {
        if (d.createdDate) monthlyCreated[`${d.createdDate.getFullYear()}-${d.createdDate.getMonth()}`] = (monthlyCreated[`${d.createdDate.getFullYear()}-${d.createdDate.getMonth()}`] || 0) + 1;
        if (d.resolvedDate) monthlyResolved[`${d.resolvedDate.getFullYear()}-${d.resolvedDate.getMonth()}`] = (monthlyResolved[`${d.resolvedDate.getFullYear()}-${d.resolvedDate.getMonth()}`] || 0) + 1;
      });
      const rKeys = Object.keys(monthlyCreated).sort((a, b) => { const [ya, ma] = a.split('-').map(Number); const [yb, mb] = b.split('-').map(Number); return ya - yb || ma - mb; });
      const rVals = rKeys.map(k => { const c = monthlyCreated[k] || 0; const r = monthlyResolved[k] || 1; return parseFloat((c / r).toFixed(2)); });

      new Chart(document.getElementById('efficiencyChart'), {
        type: 'line', data: { labels: rKeys.map(k => { const [y, m] = k.split('-'); return new Date(y, m).toLocaleString('default', { month: 'short', year: '2-digit' }) }), datasets: [{ label: 'Ratio', data: rVals, borderColor: rVals.map(v => v > 1 ? '#dc322f' : '#2aa198'), tension: 0.3 }] },
        options: { responsive: true, maintainAspectRatio: false, plugins: { annotation: { annotations: { line1: { type: 'line', yMin: 1, yMax: 1, borderColor: '#586e75', borderWidth: 2, borderDash: [5, 5] } } } }, scales: { y: { beginAtZero: true, title: { display: true, text: '>1.0 = Problem' } } } }
      });

      const prioCounts = {}; processed.forEach(d => { let p = d.priority.split(' / ')[0]; if (!p) p = "Unknown"; prioCounts[p] = (prioCounts[p] || 0) + 1; });
      const pOrder = ['Blocker', 'Critical', 'Major', 'Minor', 'Trivial']; const pData = pOrder.map(k => prioCounts[k] || 0);
      new Chart(document.getElementById('criticalityChart'), { type: 'doughnut', data: { labels: pOrder, datasets: [{ data: pData, backgroundColor: ['#dc322f', '#cb4b16', '#b58900', '#2aa198', '#859900'], borderWidth: 0 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' } } } });

      const today = new Date(); let oBuckets = { active: 0, staling: 0, rotting: 0 };
      processed.forEach(d => { const isClosed = d.status === 'Closed' || d.status === 'Done' || d.status === 'Resolved' || d.resolvedDate; if (!isClosed && d.updatedDate) { const df = Math.ceil(Math.abs(today - d.updatedDate) / (1000 * 3600 * 24)); if (df < 30) oBuckets.active++; else if (df <= 90) oBuckets.staling++; else oBuckets.rotting++; } });
      new Chart(document.getElementById('stagnationChart'), { type: 'bar', data: { labels: ['Active', 'Staling', 'Rotting'], datasets: [{ label: 'Tickets', data: [oBuckets.active, oBuckets.staling, oBuckets.rotting], backgroundColor: ['#2aa198', '#b58900', '#dc322f'], borderRadius: 4 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } } });

      // --- CAPACITY METRICS ---
      const devStats = {}; processed.forEach(d => { if (!d.assigneeName) return; if (!devStats[d.assigneeName]) devStats[d.assigneeName] = { hours: 0, count: 0 }; devStats[d.assigneeName].hours += (d.time / 3600); devStats[d.assigneeName].count++; });
      const sortedDevs = Object.entries(devStats).sort((a, b) => b[1].hours - a[1].hours).filter(d => d[1].hours > 1); const devLabels = sortedDevs.map((d, i) => `Dev ${i + 1}`); const devHours = sortedDevs.map(d => Math.round(d[1].hours));
      new Chart(document.getElementById('devLoadChart'), { type: 'bar', data: { labels: devLabels, datasets: [{ label: 'Hours', data: devHours, backgroundColor: devHours.map((h, i) => i < 3 ? '#dc322f' : '#2aa198'), borderRadius: 4 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { title: { display: true, text: 'Total Hours' } } } } });

      const velocityData = {}; processed.forEach(d => { if (d.resolvedDate && d.createdDate) { const k = `${d.resolvedDate.getFullYear()}-${d.resolvedDate.getMonth()}`; if (!velocityData[k]) velocityData[k] = { sumDays: 0, count: 0 }; const diffDays = Math.ceil(Math.abs(d.resolvedDate - d.createdDate) / (1000 * 60 * 60 * 24)); velocityData[k].sumDays += diffDays; velocityData[k].count++; } });
      const velKeys = Object.keys(velocityData).sort((a, b) => { const [ya, ma] = a.split('-').map(Number); const [yb, mb] = b.split('-').map(Number); return ya - yb || ma - mb; });
      new Chart(document.getElementById('velocityChart'), { type: 'line', data: { labels: velKeys.map(k => { const [y, m] = k.split('-'); return new Date(y, m).toLocaleString('default', { month: 'short', year: '2-digit' }); }), datasets: [{ label: 'Avg Days', data: velKeys.map(k => Math.round(velocityData[k].sumDays / velocityData[k].count)), borderColor: '#cb4b16', backgroundColor: 'rgba(203, 75, 22, 0.1)', fill: true, tension: 0.4 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } } });

      const startD = processed[0].createdDate || new Date(); const endD = new Date(); let iter = new Date(startD.getFullYear(), startD.getMonth() + 1, 0); const ageLabels = []; const ageValues = [];
      while (iter <= endD) { const snapshotDate = new Date(iter); const openAtIndex = processed.filter(p => { if (!p.createdDate) return false; return (p.createdDate <= snapshotDate) && (!p.resolvedDate || p.resolvedDate > snapshotDate); }); if (openAtIndex.length > 0) { ageValues.push(Math.round(openAtIndex.reduce((acc, p) => acc + (snapshotDate - p.createdDate) / (1000 * 60 * 60 * 24), 0) / openAtIndex.length)); } else { ageValues.push(0); } ageLabels.push(snapshotDate.toLocaleString('default', { month: 'short', year: '2-digit' })); iter = new Date(iter.getFullYear(), iter.getMonth() + 2, 0); }
      new Chart(document.getElementById('agingChart'), { type: 'line', data: { labels: ageLabels, datasets: [{ label: 'Avg Age', data: ageValues, borderColor: '#dc322f', backgroundColor: 'rgba(220, 50, 47, 0.1)', fill: true, tension: 0.4, pointRadius: 4 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } } });

      const dateChanges = {}; processed.forEach(d => { if (d.createdDate) dateChanges[d.createdDate.toISOString().split('T')[0]] = (dateChanges[d.createdDate.toISOString().split('T')[0]] || 0) + 1; if (d.resolvedDate) dateChanges[d.resolvedDate.toISOString().split('T')[0]] = (dateChanges[d.resolvedDate.toISOString().split('T')[0]] || 0) - 1; });
      let backlog = 0; const bData = []; const bLabels = []; let dIter = new Date(startD); while (dIter <= endD) { const k = dIter.toISOString().split('T')[0]; backlog += (dateChanges[k] || 0); bLabels.push(k); bData.push(backlog); dIter.setDate(dIter.getDate() + 1); }
      new Chart(document.getElementById('burndownChart'), { type: 'line', data: { labels: bLabels, datasets: [{ label: 'Backlog', data: bData, borderColor: '#6c71c4', backgroundColor: 'rgba(108, 113, 196, 0.1)', fill: true, pointRadius: 0, borderWidth: 2 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { x: { type: 'time', time: { unit: 'month' }, grid: { display: false } }, y: { beginAtZero: true } } } });

      const countryStats = {}; processed.forEach(d => { countryStats[d.countryResolved] = (countryStats[d.countryResolved] || 0) + 1; });
      const cSorted = Object.entries(countryStats).filter(e => e[0] !== 'Global/Unspecified').sort((a, b) => b[1] - a[1]).slice(0, 10);
      new Chart(document.getElementById('countryChart'), { type: 'bar', data: { labels: cSorted.map(e => e[0]), datasets: [{ label: 'Tickets', data: cSorted.map(e => e[1]), backgroundColor: '#2aa198' }] }, options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false } });

      const listContainer = document.getElementById('issuesList'); listContainer.innerHTML = '';
      topIssues.forEach((issue, idx) => { const pct = (issue.count / (topIssues[0].count || 1)) * 100; const d = document.createElement('div'); d.className = "relative p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors bg-white"; d.innerHTML = `<div class="flex justify-between items-start mb-2 relative z-10"><div class="flex items-start"><span class="w-8 h-8 flex-shrink-0 flex items-center justify-center rounded-full bg-[#eee8d5] text-[#586e75] font-bold mr-3 mt-1">#${idx + 1}</span><div><span class="font-bold capitalize text-[#586e75] text-lg block">${issue.phrase}</span><span class="text-xs text-[#93a1a1] italic block mt-1">"${issue.example}"</span></div></div><div class="text-right flex-shrink-0 ml-4"><div class="text-2xl font-bold text-[#268bd2]">${issue.count}</div><div class="text-sm text-[#b58900] font-semibold">${Math.round(issue.time / 3600)}h</div></div></div><div class="w-full bg-gray-200 rounded-full h-2.5 mb-1 overflow-hidden mt-2"><div class="bg-[#268bd2] h-2.5 rounded-full" style="width: ${pct}%"></div></div>`; listContainer.appendChild(d); });
    });
  </script>
</body>

</html>
